<?php

namespace Sdz\MainBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * CommandeRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CommandeRepository extends EntityRepository
{

	public function getCommande($id)
	{
		$query = $this->_em->createQuery('SELECT c.id AS id, c.date AS date, 
		SUM(p.prix) AS montant FROM SdzMainBundle:Commande c, SdzMainBundle:LigneCommande l,
		SdzMainBundle:Produit p WHERE c.id = l.commande AND l.produit = p.id AND c.id = :id');

		$query->setParameter('id', $id);

		return $query->getSingleResult();
	}

	public function getUserCommande($id)
	{
		$query = $this->_em->createQuery('SELECT c.id AS id, c.date AS date, 
		SUM(p.prix) AS montant FROM SdzMainBundle:Commande c, SdzMainBundle:LigneCommande l,
		SdzMainBundle:Produit p, SdzMainBundle:Utilsateur u WHERE c.id = l.commande AND 
		l.produit = p.id AND c.utilisateur = u.id AND u.id = :id');

		$query->setParameter('id', $id);

		return $query->getResult();
	}

	public function getMontantCommande()
	{
		$query = $this->_em->createQuery('SELECT c.id AS id, c.date AS date, 
		SUM(p.prix) AS montant FROM SdzMainBundle:Commande c, SdzMainBundle:LigneCommande l,
		SdzMainBundle:Produit p WHERE c.id = l.commande AND l.produit = p.id');

		return $query->getResult();
	}

	
}
